FROM rust:1.72.0-bookworm

RUN apt-get update && apt-get install -yq socat procps

WORKDIR /app
COPY app.py app.py

USER 404:404

CMD while true; do \
        # Remove binary files generated by app.py
        find /tmp -type f -not -name "*.*" | xargs --no-run-if-empty rm; \
        sleep 30s; \
    done & \
    socat -T30 tcp-listen:1337,fork,reuseaddr exec:"python3 app.py",pty,raw,echo=0
